{% extends "base.html" %}
{% block title %}My Profile{% endblock %}
{% block extra_head %}
<style>
.profile-header{background:linear-gradient(135deg,var(--primary),var(--tertiary));border-radius:16px;padding:48px 32px;color:#fff;margin-bottom:24px;display:flex;align-items:center;gap:32px}
.profile-avatar{width:120px;height:120px;border-radius:50%;background:rgba(255,255,255,.2);display:flex;align-items:center;justify-content:center;font-size:48px;font-weight:500;border:4px solid rgba(255,255,255,.3)}
.profile-info{flex:1}
.profile-name{font-size:2rem;font-weight:600;margin:0 0 4px}
.profile-role{font-size:1rem;opacity:.9;margin:0 0 12px}
.profile-status{display:inline-flex;align-items:center;gap:8px;background:rgba(255,255,255,.2);padding:6px 16px;border-radius:999px}
.status-dot{width:8px;height:8px;border-radius:50%;background:#4ade80}
.profile-actions{display:flex;gap:12px}
.profile-actions .btn{background:rgba(255,255,255,.2);color:#fff;border:1px solid rgba(255,255,255,.3)}
.profile-grid{display:grid;grid-template-columns:1fr 1fr;gap:24px}
@media(max-width:768px){.profile-grid{grid-template-columns:1fr}.profile-header{flex-direction:column;text-align:center}}
.profile-section{background:var(--surface);border-radius:12px;border:1px solid var(--outline-variant);padding:24px;margin-bottom:24px}
.profile-section h3{font-size:1.125rem;font-weight:600;margin:0 0 20px;display:flex;align-items:center;gap:8px}
.profile-section h3 .material-icons-round{color:var(--primary)}
.info-grid{display:grid;gap:16px}
.info-item{display:flex;flex-direction:column;gap:4px}
.info-label{font-size:.75rem;text-transform:uppercase;color:var(--on-surface-variant);font-weight:500}
.info-value{font-size:1rem}
.stats-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.stat-card{background:var(--surface-variant);border-radius:8px;padding:16px;text-align:center}
.stat-value{font-size:1.75rem;font-weight:600;color:var(--primary)}
.stat-label{font-size:.75rem;color:var(--on-surface-variant);margin-top:4px}
.activity-list{display:flex;flex-direction:column;gap:12px}
.activity-item{display:flex;gap:12px;padding:12px;background:var(--surface-variant);border-radius:8px}
.activity-icon{width:40px;height:40px;border-radius:50%;background:var(--primary-container);display:flex;align-items:center;justify-content:center}
.activity-icon .material-icons-round{font-size:20px;color:var(--primary)}
.activity-text{font-size:.875rem;margin-bottom:4px}
.activity-time{font-size:.75rem;color:var(--on-surface-variant)}
.quick-actions{display:grid;grid-template-columns:1fr 1fr;gap:12px}
.quick-action-btn{display:flex;flex-direction:column;align-items:center;gap:8px;padding:20px 16px;background:var(--surface-variant);border:none;border-radius:8px;cursor:pointer;transition:.2s}
.quick-action-btn:hover{background:var(--primary-container)}
.quick-action-btn .material-icons-round{font-size:28px;color:var(--primary)}
.quick-action-btn span:last-child{font-size:.8125rem}
.modal-overlay{display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,.5);z-index:1000;align-items:center;justify-content:center}
.modal-overlay.active{display:flex}
.modal-content{background:var(--surface);border-radius:16px;width:90%;max-width:500px;max-height:90vh;overflow-y:auto}
.modal-header{padding:24px 24px 16px;border-bottom:1px solid var(--outline-variant);display:flex;align-items:center;justify-content:space-between}
.modal-header h2{font-size:1.25rem;margin:0}
.modal-body{padding:24px}
.modal-footer{padding:16px 24px 24px;display:flex;justify-content:flex-end;gap:12px}
.form-group{margin-bottom:20px}
.form-group label{display:block;font-size:.875rem;font-weight:500;margin-bottom:6px}
.form-group input,.form-group textarea,.form-group select{width:100%;padding:12px 16px;border:1px solid var(--outline-variant);border-radius:8px;font-size:1rem;background:var(--surface);color:var(--on-surface)}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
</style>
{% endblock %}
{% block content %}
<div class="profile-header">
<div class="profile-avatar" id="profileAvatar"><span id="avatarInitials">--</span></div>
<div class="profile-info"><h1 class="profile-name" id="profileName">Loading...</h1><p class="profile-role" id="profileRole">User</p><div class="profile-status"><span class="status-dot"></span><span>Active</span></div></div>
<div class="profile-actions"><button class="btn" onclick="openEditModal()"><span class="material-icons-round">edit</span> Edit</button><button class="btn" onclick="location.href='/settings'"><span class="material-icons-round">settings</span> Settings</button></div>
</div>
<div class="profile-grid">
<div>
<div class="profile-section"><h3><span class="material-icons-round">person</span> Personal Info</h3>
<div class="info-grid">
<div class="info-item"><span class="info-label">Name</span><span class="info-value" id="infoName">--</span></div>
<div class="info-item"><span class="info-label">Email</span><span class="info-value" id="infoEmail">--</span></div>
<div class="info-item"><span class="info-label">Phone</span><span class="info-value" id="infoPhone">--</span></div>
<div class="info-item"><span class="info-label">Title</span><span class="info-value" id="infoTitle">--</span></div>
</div></div>
<div class="profile-section"><h3><span class="material-icons-round">insights</span> Stats</h3>
<div class="stats-grid">
<div class="stat-card"><div class="stat-value" id="statDeals">0</div><div class="stat-label">Deals</div></div>
<div class="stat-card"><div class="stat-value" id="statRevenue">$0</div><div class="stat-label">Revenue</div></div>
<div class="stat-card"><div class="stat-value" id="statContacts">0</div><div class="stat-label">Contacts</div></div>
<div class="stat-card"><div class="stat-value" id="statTasks">0</div><div class="stat-label">Tasks</div></div>
</div></div>
</div>
<div>
<div class="profile-section"><h3><span class="material-icons-round">flash_on</span> Quick Actions</h3>
<div class="quick-actions">
<button class="quick-action-btn" onclick="location.href='/deals'"><span class="material-icons-round">handshake</span><span>Deal</span></button>
<button class="quick-action-btn" onclick="location.href='/contacts'"><span class="material-icons-round">person_add</span><span>Contact</span></button>
<button class="quick-action-btn" onclick="location.href='/tasks'"><span class="material-icons-round">add_task</span><span>Task</span></button>
<button class="quick-action-btn" onclick="location.href='/reports'"><span class="material-icons-round">assessment</span><span>Reports</span></button>
</div></div>
<div class="profile-section"><h3><span class="material-icons-round">history</span> Activity</h3>
<div class="activity-list" id="activityList"><div class="activity-item"><div class="activity-icon"><span class="material-icons-round">sync</span></div><div><div class="activity-text">Loading...</div><div class="activity-time">--</div></div></div></div>
</div>
</div>
</div>
<div class="modal-overlay" id="editModal">
<div class="modal-content">
<div class="modal-header"><h2>Edit Profile</h2><button class="btn btn-icon btn-ghost" onclick="closeModal()"><span class="material-icons-round">close</span></button></div>
<div class="modal-body">
<div class="form-row"><div class="form-group"><label>First Name</label><input id="editFirst"></div><div class="form-group"><label>Last Name</label><input id="editLast"></div></div>
<div class="form-group"><label>Email</label><input id="editEmail" type="email"></div>
<div class="form-group"><label>Phone</label><input id="editPhone"></div>
<div class="form-group"><label>Title</label><input id="editTitle"></div>
</div>
<div class="modal-footer"><button class="btn btn-secondary" onclick="closeModal()">Cancel</button><button class="btn btn-primary" onclick="saveProfile()">Save</button></div>
</div>
</div>
{% endblock %}
{% block scripts %}
<script>
let user=null;
document.addEventListener('DOMContentLoaded',()=>{loadProfile();loadStats();loadActivity()});
async function loadProfile(){try{const r=await fetch('/api/profile');if(r.ok){user=await r.json();render()}}catch(e){console.error(e)}}
function render(){if(!user)return;const fn=user.first_name||'',ln=user.last_name||'',name=(fn+' '+ln).trim()||user.email||'User';document.getElementById('avatarInitials').textContent=(fn[0]||'')+(ln[0]||'')||'U';document.getElementById('profileName').textContent=name;document.getElementById('profileRole').textContent=user.title||'Member';document.getElementById('infoName').textContent=name;document.getElementById('infoEmail').textContent=user.email||'--';document.getElementById('infoPhone').textContent=user.phone||'--';document.getElementById('infoTitle').textContent=user.title||'--'}
async function loadStats(){try{const d=await fetch('/api/deals').then(r=>r.json());const c=d.filter(x=>x.stage==='Closed Won');document.getElementById('statDeals').textContent=c.length;document.getElementById('statRevenue').textContent='$'+c.reduce((s,x)=>s+(x.amount||0),0).toLocaleString();const ct=await fetch('/api/contacts').then(r=>r.json());document.getElementById('statContacts').textContent=ct.length;const t=await fetch('/api/tasks').then(r=>r.json());document.getElementById('statTasks').textContent=t.filter(x=>x.completed||x.status==='completed').length}catch(e){}}
function loadActivity(){document.getElementById('activityList').innerHTML=[{i:'handshake',t:'Closed deal',d:'2h ago'},{i:'person_add',t:'Added contact',d:'5h ago'},{i:'task_alt',t:'Task done',d:'Yesterday'}].map(a=>'<div class="activity-item"><div class="activity-icon"><span class="material-icons-round">'+a.i+'</span></div><div><div class="activity-text">'+a.t+'</div><div class="activity-time">'+a.d+'</div></div></div>').join('')}
function openEditModal(){if(user){document.getElementById('editFirst').value=user.first_name||'';document.getElementById('editLast').value=user.last_name||'';document.getElementById('editEmail').value=user.email||'';document.getElementById('editPhone').value=user.phone||'';document.getElementById('editTitle').value=user.title||''}document.getElementById('editModal').classList.add('active')}
function closeModal(){document.getElementById('editModal').classList.remove('active')}
async function saveProfile(){const d={first_name:document.getElementById('editFirst').value,last_name:document.getElementById('editLast').value,email:document.getElementById('editEmail').value,phone:document.getElementById('editPhone').value,title:document.getElementById('editTitle').value};try{const r=await fetch('/api/profile',{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify(d)});if(r.ok){user=await r.json();render();closeModal()}}catch(e){}}
</script>
{% endblock %}
